using System;
using System.Collections.Generic;
using System.Configuration;
using System.Globalization;
using System.Net;
using System.Net.Http;
using System.Text;
using System.Xml;
using Engine.Cloud.Core.Domain.Services.VirtualMachine.Mappers;
using Engine.Cloud.Core.Model;
using Engine.Cloud.Core.Model.Results;
using Engine.Cloud.Core.Utils.Logging;
using Utils;

namespace Engine.Cloud.Core.Domain.Services.VirtualMachine
{
    public class VirtualMachineServiceXenSp : XenServiceBase, IVirtualMachineService
    {
        private readonly ILogger _logger;
        public string UrlBase { get; set; }

        public VirtualMachineServiceXenSp()
        {
            _logger = LogFactory.GetInstance();
            UrlBase = ConfigurationManager.AppSettings.Get("Cloud.XenSP1.UrlWS");
        }

        public void Load(Server server)
        {
            UrlBase += "cloud/rest/vmathost/" + server.HypervisorIdentifier;
            
            var xmlDocument = new XmlDocument();

            try
            {
                HttpResponseMessage httpResponseMessage;

                using (var httpClient = new HttpClient())
                {
                    httpClient.BaseAddress = new Uri(UrlBase);
                    httpClient.Timeout = TimeSpan.FromSeconds(HTTP_TIMEOUT * 10);
                    httpResponseMessage = httpClient.GetAsync(UrlBase).Result;

                    if ((httpResponseMessage.StatusCode == HttpStatusCode.NotFound) || (httpResponseMessage.StatusCode == HttpStatusCode.InternalServerError) || (httpResponseMessage.StatusCode == HttpStatusCode.NoContent))
                        server.RemoteStatus = RemoteStatus.DontExist;
                    else
                        httpResponseMessage.EnsureSuccessStatusCode();
                }

                var response = httpResponseMessage.Content.ReadAsStringAsync().Result;

                if (response.ToUpper().Contains("DONT_EXIST") || string.IsNullOrEmpty(response))
                    return;

                xmlDocument.LoadXml(response);

                new MapperVirtualMachineServiceXenSp(xmlDocument).MapperToServer(server);
            }
            catch (Exception ex)
            {
                _logger.Log(string.Format("{0}, request: {1}", LogUtils.GetCurrentMethod(this), UrlBase), ex);
                throw;
            }
        }

        public Server Load(string hypervisorIdentifier)
        {
            UrlBase += "cloud/rest/vmathost/" + hypervisorIdentifier;

            try
            {
                var xmlDocument = new XmlDocument();

                HttpResponseMessage httpResponseMessage;

                using (var httpClient = new HttpClient())
                {
                    httpClient.BaseAddress = new Uri(UrlBase);
                    httpClient.Timeout = TimeSpan.FromSeconds(HTTP_TIMEOUT * 10);
                    httpResponseMessage = httpClient.GetAsync(UrlBase).Result;

                    httpResponseMessage.EnsureSuccessStatusCode();
                }

                var server = new Server();
                xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
                new MapperVirtualMachineServiceXenSp(xmlDocument).MapperToServer(server);
                return server;
            }
            catch (Exception ex)
            {
                _logger.Log(string.Format("{0}, request: {1}", LogUtils.GetCurrentMethod(this), UrlBase), ex);
                throw;
            }
        }

        public void LoadAll(List<Server> servers)
        {
            UrlBase += "cloud/rest/maintenance/virtualmachine/all";

            try
            {
                var xmlDocument = new XmlDocument();

                HttpResponseMessage httpResponseMessage;

                using (var httpClient = new HttpClient())
                {
                    httpClient.BaseAddress = new Uri(UrlBase);
                    httpClient.Timeout = TimeSpan.FromSeconds(999999);
                    httpResponseMessage = httpClient.GetAsync(UrlBase).Result;
                    httpResponseMessage.EnsureSuccessStatusCode();
                }

                xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
                new MapperVirtualMachineServiceXenSp(xmlDocument).MapperToServers(servers);
            }
            catch (Exception ex)
            {
                _logger.Log(string.Format("{0}, request: {1}", LogUtils.GetCurrentMethod(this), UrlBase), ex);
                throw;
            }
        }

        public ServiceResult Install(Client client, byte vcpu, int frequency, int memory, string image, int diskSize, decimal[] bandwidths, int partitions, string formatDisk, long serverId)
        {
            var sbBody = "";
            sbBody += "<virtualmachine>";
            sbBody += "<vcpu>" + vcpu + "</vcpu>";
            sbBody += "<memory>" + (memory * 1024 * 1024) + "</memory>";
            sbBody += "<frequency>" + frequency + "</frequency>";
            sbBody += "<software>";
            sbBody += "<name>" + image + "</name>";

            if (partitions == 1)
                sbBody += "<size>" + diskSize + "</size>";
            else
                sbBody += "<size>" + (image.Contains("windows") == true ? 32 : 10) + "</size>";

            sbBody += "</software>";
            sbBody += "<user>";
            sbBody += "<name>" + client.CustomerCode.Replace(".", "") + "</name>";
            sbBody += "</user>";
            sbBody += "<networkinterfaces>";

            foreach (var bandwidth in bandwidths)
            {
                sbBody += "<networkinterface>";
                if (bandwidth > 0)
                    sbBody += "<bandwidth>" + bandwidth.ToString(CultureInfo.InvariantCulture).Replace(",", ".") + "</bandwidth>";
                else
                    sbBody += "<bandwidth></bandwidth>";
                sbBody += "</networkinterface>";
            }

            sbBody += "</networkinterfaces>";

            if (partitions != 1)
            {
                sbBody += "<disks>";
                sbBody += "<disk>";
                sbBody += "<size>" + (diskSize - (image.Contains("windows") == true ? 32 : 10)) + "</size>";
                if (formatDisk != "")
                    sbBody += "<fileSystem>" + "</fileSystem>";
                sbBody += "</disk>";
                sbBody += "</disks>";
            }
            sbBody += "</virtualmachine>";

            var scheduleddate = DateTime.Now.Date.ToString("yyyy-MM-dd");
            var scheduledtime = DateTime.Now.TimeOfDay.ToString().Split('.')[0];
            UrlBase += "cloud/rest/servicecode/" + Guid.NewGuid() + "/scheduleddate/" + scheduleddate + "/scheduledtime/" + scheduledtime + "/virtualmachine";
            var xmlDocument = new XmlDocument();

            HttpResponseMessage httpResponseMessage;
            _logger.Log(string.Format("{0}, request: {1}, body: {2}", LogUtils.GetCurrentMethod(this), UrlBase, sbBody));

            using (var httpClient = new HttpClient())
            {
                HttpContent myContent = new StringContent(sbBody, Encoding.UTF8, "application/xml");
                httpClient.BaseAddress = new Uri(UrlBase);
                httpResponseMessage = httpClient.PostAsync(UrlBase, myContent).Result;
                httpResponseMessage.EnsureSuccessStatusCode();
            }

            xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
            _logger.Log(string.Format("{0}, response: {1}", LogUtils.GetCurrentMethod(this), xmlDocument.OuterXml));
            return ParseXmlResult(xmlDocument);

            #region SUCESS RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine snapshotIdentifier="169"><identifier>71</identifier><name>CD119740-linux-centos-5-64b-base-71</name><queueitem><identifier>440</identifier><name>INSTALL</name><state>ON_QUEUE</state><numberOfFailures>0</numberOfFailures><serviceCode>4bb2c1ab-8865-478d-a018-d2610a5d1b61</serviceCode><returnUrl>http://127.0.0.1:8080/cloud/rest/PortalDelivery</returnUrl><scope>VirtualMachine</scope><delegatedQueueItems><queueitem><identifier>441</identifier><name>CONFIGURE</name><state>ON_QUEUE</state><numberOfFailures>0</numberOfFailures><scope>NetworkInterface</scope><delegatedQueueItems /><startExecution>2014-10-22T13:55:07.624-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep></queueitem></delegatedQueueItems><startExecution>2014-10-22T13:55:07.512-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>true</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep></queueitem><disks><disk snapshotIdentifier="321"><identifier>97</identifier><name>d97</name><device>vda</device><format>qcow2</format><size>0</size><storage><identifier>1</identifier><name>spk1h001</name><region>TB2</region><admState>regular</admState><ip>177.70.105.132</ip><keepalive>5</keepalive><opState>running</opState><port>5200</port><technology>local</technology><version></version><freeSize>12660507865088</freeSize><size>13402</size></storage></disk></disks><frequency>900</frequency><memory>512000</memory><networkinterfaces><networkinterface snapshotIdentifier="170"><identifier>71</identifier><name>tec71.0</name><queueitem><identifier>441</identifier><name>CONFIGURE</name><state>ON_QUEUE</state><numberOfFailures>0</numberOfFailures><scope>NetworkInterface</scope><delegatedQueueItems /><startExecution>2014-10-22T13:55:07.624-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep></queueitem><bandwidth>1.0</bandwidth><ipv4>10.17.0.23</ipv4><mac>00:16:3e:84:66:f3</mac><monitor><identifier>4</identifier><user><identifier>3</identifier><name>CD119740</name><additionalips /><firewallrules /><ipranges /><vlans /></user><vlan dhcp="true" firewall="true" validRange="false"><flags>BACKEND</flags><identifier>3</identifier><name>vlan4</name><region>TB2</region><firewallrules /><ipranges><iprange additional="false"><identifier>2</identifier><region>TB2</region><firstip>10.17.0.20</firstip><lastip>10.17.0.30</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>2</identifier><name>ceph_mon</name><region>TB2</region><ip>177.70.104.47</ip><externalIf>eth0</externalIf><internalIf>eth1</internalIf><rate>1000Mbit</rate><secondaryVirtualIp>177.70.104.47</secondaryVirtualIp></router><vlanid>4</vlanid></vlan></monitor><vlan dhcp="true" firewall="true" validRange="false"><flags>BACKEND</flags><identifier>3</identifier><name>vlan4</name><region>TB2</region><firewallrules /><ipranges><iprange additional="false"><identifier>2</identifier><region>TB2</region><firstip>10.17.0.20</firstip><lastip>10.17.0.30</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>2</identifier><name>ceph_mon</name><region>TB2</region><ip>177.70.104.47</ip><externalIf>eth0</externalIf><internalIf>eth1</internalIf><rate>1000Mbit</rate><secondaryVirtualIp>177.70.104.47</secondaryVirtualIp></router><vlanid>4</vlanid></vlan></networkinterface></networkinterfaces><software><identifier>1</identifier><name>linux-centos-5-64b-base</name><fileSystem>ext3</fileSystem><initialDisks><initialDisk><identifier>1</identifier><diskName>vda</diskName><diskType>SO</diskType><format>qcow2</format></initialDisk></initialDisks><size>0</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>1</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><vlans /></user><version>0</version></software><softwareVersion>0</softwareVersion><storage><identifier>1</identifier><name>spk1h001</name><region>TB2</region><admState>regular</admState><ip>177.70.105.132</ip><keepalive>5</keepalive><opState>running</opState><port>5200</port><technology>local</technology><version></version><freeSize>12660507865088</freeSize><size>13402</size></storage><user><identifier>3</identifier><name>CD119740</name><additionalips /><firewallrules /><ipranges /><vlans /></user><vcpu>2</vcpu></virtualmachine>
            #endregion

            #region FAIL RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine><queueitem><identifier>0</identifier><name>INSTALL</name><state>REJECTED</state><numberOfFailures>0</numberOfFailures><serviceCode>4bb2c1ab-8865-478d-a018-d2610a5d1b61</serviceCode><returnUrl>http://127.0.0.1:8080/cloud/rest/PortalDelivery</returnUrl><scope>VirtualMachine</scope><delegatedQueueItems /><startExecution>2014-10-22T13:55:50.896-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep><message>ValidationException: ServiceCode is not unique</message></queueitem><frequency>900</frequency><memory>512000</memory><networkinterfaces><networkinterface><bandwidth>1.0</bandwidth></networkinterface></networkinterfaces><software><name>linux-centos-5-64b-base</name></software><user><name>CD119740</name></user><vcpu>2</vcpu></virtualmachine>
            #endregion
        }

        public ServiceResult Uninstall(Server server)
        {

            if (server.StatusBlockId == (int) StatusBlock.Suspend)
                Unlock(server);
            
            UrlBase += "cloud/rest/servicecode/" + Guid.NewGuid() + "/virtualmachine/" + server.Name;
            var xmlDocument = new XmlDocument();

            HttpResponseMessage httpResponseMessage;
            _logger.Log(string.Format("{0}, request: {1}", LogUtils.GetCurrentMethod(this), UrlBase));

            using (var httpClient = new HttpClient())
            {
                httpClient.BaseAddress = new Uri(UrlBase);
                httpClient.Timeout = TimeSpan.FromMinutes(HTTP_TIMEOUT);
                httpResponseMessage = httpClient.DeleteAsync(UrlBase).Result;
                httpResponseMessage.EnsureSuccessStatusCode();
            }

            xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
            _logger.Log(string.Format("{0}, response: {1}", LogUtils.GetCurrentMethod(this), xmlDocument.OuterXml));
            return ParseXmlResult(xmlDocument);

            #region SUCESS RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine snapshotIdentifier="35839"><identifier>25057</identifier><queueitem><identifier>82320</identifier><name>UNINSTALL</name><state>COMPLETED</state><numberOfFailures>0</numberOfFailures><serviceCode>73f64f1f-b701-4192-94d2-c4990758d0db</serviceCode><delegatedQueueItems><queueitem><identifier>82321</identifier><name>DOWNGRADE</name><state>COMPLETED</state><numberOfFailures>0</numberOfFailures><delegatedQueueItems /><startExecution>2014-10-23T15:53:16.026-02:00</startExecution><lastUpdated>2014-10-23T15:53:25.163-02:00</lastUpdated><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>7</expectedSteps><currentStep>7</currentStep><delegationScope></delegationScope></queueitem></delegatedQueueItems><startExecution>2014-10-23T15:53:15.878-02:00</startExecution><lastUpdated>2014-10-23T15:53:25.164-02:00</lastUpdated><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>9</expectedSteps><currentStep>7</currentStep></queueitem></virtualmachine>
            #endregion

            #region FAIL RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine><queueitem><identifier>0</identifier><name>UNINSTALL</name><state>REJECTED</state><numberOfFailures>0</numberOfFailures><serviceCode>73f64f1f-b701-4192-94d2-c4990758d0db</serviceCode><delegatedQueueItems /><startExecution>2014-10-23T15:54:15.598-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep><message>ValidationException: ServiceCode is not unique</message></queueitem></virtualmachine>
            #endregion
        }

        public ServiceResult Reinstall(Server server, Image image)
        {
            var sbBody = "";
            sbBody += "<virtualmachine>";
            sbBody += "<name>" + server.Name + "</name>";
            sbBody += "<status>reinstall</status>";
            sbBody += "<software>";
            sbBody += "<name>" + image.Name + "</name>";
            sbBody += "</software>";
            sbBody += "</virtualmachine>";

            var scheduleddate = DateTime.Now.Date.ToString("yyyy-MM-dd");
            var scheduledtime = DateTime.Now.TimeOfDay.ToString().Split('.')[0];

            UrlBase += "cloud/rest/servicecode/" + Guid.NewGuid() + "/scheduleddate/" + scheduleddate + "/scheduledtime/" + scheduledtime + "/virtualmachine";
            var xmlDocument = new XmlDocument();

            HttpResponseMessage httpResponseMessage;
            _logger.Log(string.Format("{0}, request: {1}, body: {2}", LogUtils.GetCurrentMethod(this), UrlBase, sbBody));

            using (var httpClient = new HttpClient())
            {
                HttpContent myContent = new StringContent(sbBody, Encoding.UTF8, "application/xml");
                httpClient.BaseAddress = new Uri(UrlBase);
                httpResponseMessage = httpClient.PutAsync(UrlBase, myContent).Result;
                httpResponseMessage.EnsureSuccessStatusCode();
            }

            xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
            _logger.Log(string.Format("{0}, response: {1}", LogUtils.GetCurrentMethod(this), xmlDocument.OuterXml));
            return ParseXmlResult(xmlDocument);

            #region SUCESS RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine snapshotIdentifier="35840"><identifier>24946</identifier><name>CD119740-linux-centos-6-64b-base-sx-24946</name><queueitem><identifier>82322</identifier><name>REINSTALL</name><state>SCHEDULED</state><numberOfFailures>0</numberOfFailures><serviceCode>92606cae-3a9f-4405-b720-0d47c240decc</serviceCode><delegatedQueueItems /><startExecution>2014-10-23T16:01:46-02:00</startExecution><doPoweroff>true</doPoweroff><doPoweron>true</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep></queueitem><region>TB1</region><state>POWERED_ON</state><cluster><identifier>1028</identifier><iprange additional="false"><identifier>22</identifier><firstip>177.70.122.10</firstip><lastip>177.70.123.250</lastip></iprange><software><flags>LINUX</flags><identifier>1</identifier><name>linux-centos-6-64b-base-sx</name><fileSystem>ext4</fileSystem><initialDisks><initialDisk><identifier>1</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>10</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4505808666624</freeSize><internalIp>10.15.0.2</internalIp><size>40053</size></storage></cluster><disks><disk snapshotIdentifier="71197"><identifier>9330</identifier><name>d9330</name><device>xvdb</device><diskType>DATA</diskType><format>vhd</format><size>40</size><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4505808666624</freeSize><internalIp>10.15.0.2</internalIp><size>40053</size></storage><user><identifier>637</identifier><name>CD119740</name><ipranges /></user></disk><disk snapshotIdentifier="71198"><identifier>9714</identifier><name>d9714</name><device>xvda</device><diskType>SO</diskType><format>raw</format><size>40</size><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4505808666624</freeSize><internalIp>10.15.0.2</internalIp><size>40053</size></storage></disk></disks><frequency>900</frequency><host><flags>NO_TRUEBOX,NO_SQL,NO_WIN7</flags><identifier>7</identifier><name>spc1p007</name><region>TB1</region><state>POWERED_ON</state><admState>minor</admState><ip>177.70.104.141</ip><keepalive>3</keepalive><opState>loaded</opState><port>5200</port><technology>xen</technology><version>42</version><freeMemory>5903</freeMemory><frequency>2000</frequency><loadAverage>18.19</loadAverage><memory>393170</memory><storages><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4505808666624</freeSize><internalIp>10.15.0.2</internalIp><size>40053</size></storage><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4579812966400</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage><storage><identifier>10</identifier><name>rbdpool</name><state>POWERED_ON</state><admState>minor</admState><ip>177.70.104.208</ip><keepalive>5</keepalive><opState>running</opState><port>5200</port><technology>rbd</technology><version></version><freeSize>91438760984576</freeSize><size>207483</size></storage></storages><vcpu>32</vcpu></host><memory>1048576</memory><networkinterfaces><networkinterface snapshotIdentifier="40112"><identifier>5174</identifier><name>tec24946.0</name><bandwidth>1.0</bandwidth><ipv4>177.70.122.13</ipv4><mac>00:16:3e:c5:b0:23</mac><monitor><identifier>2853</identifier><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vlan validRange="true" firewall="true" dhcp="true"><identifier>11</identifier><name>virtbr503</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>22</identifier><firstip>177.70.122.10</firstip><lastip>177.70.123.250</lastip></iprange><iprange additional="false"><identifier>40</identifier><firstip>192.168.218.7</firstip><lastip>192.168.218.254</lastip></iprange><iprange additional="false"><identifier>41</identifier><firstip>192.168.219.7</firstip><lastip>192.168.219.254</lastip></iprange><iprange additional="false"><identifier>42</identifier><firstip>192.168.220.7</firstip><lastip>192.168.220.254</lastip></iprange><iprange additional="false"><identifier>45</identifier><firstip>192.168.223.7</firstip><lastip>192.168.223.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>3</identifier><name>SPFW003</name><region>TB1</region><admState>regular</admState><ip>177.70.111.228</ip><externalIf>bond0.1004</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>503</vlanid></vlan></monitor><vlan validRange="true" firewall="true" dhcp="true"><identifier>11</identifier><name>virtbr503</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>22</identifier><firstip>177.70.122.10</firstip><lastip>177.70.123.250</lastip></iprange><iprange additional="false"><identifier>40</identifier><firstip>192.168.218.7</firstip><lastip>192.168.218.254</lastip></iprange><iprange additional="false"><identifier>41</identifier><firstip>192.168.219.7</firstip><lastip>192.168.219.254</lastip></iprange><iprange additional="false"><identifier>42</identifier><firstip>192.168.220.7</firstip><lastip>192.168.220.254</lastip></iprange><iprange additional="false"><identifier>45</identifier><firstip>192.168.223.7</firstip><lastip>192.168.223.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>3</identifier><name>SPFW003</name><region>TB1</region><admState>regular</admState><ip>177.70.111.228</ip><externalIf>bond0.1004</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>503</vlanid></vlan></networkinterface></networkinterfaces><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vcpu>2</vcpu><vncPasswd>yEnPXRBhq1</vncPasswd><vncPort>5961</vncPort></virtualmachine>
            #endregion

            #region FAIL RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine><identifier>24946</identifier><name>CD119740-linux-centos-6-64b-base-sx-24946</name><queueitem><identifier>0</identifier><name>REINSTALL</name><state>REJECTED</state><numberOfFailures>0</numberOfFailures><serviceCode>92606cae-3a9f-4405-b720-0d47c240decc</serviceCode><delegatedQueueItems /><startExecution>2014-10-23T16:01:46-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep><message>ValidationException: ServiceCode is not unique</message></queueitem><software><name>windows-2012-64b-std-web-sx</name></software></virtualmachine>
            #endregion
        }

        public ServiceResult PowerOn(Server server)
        {
            var sbBody = "";
            sbBody += "<virtualmachine>";
            sbBody += "<name>" + server.Name + "</name>";
            sbBody += "<status>poweron</status>";
            sbBody += "</virtualmachine>";

            var scheduleddate = DateTime.Now.Date.ToString("yyyy-MM-dd");
            var scheduledtime = DateTime.Now.TimeOfDay.ToString().Split('.')[0];

            UrlBase += "cloud/rest/servicecode/" + Guid.NewGuid() + "/scheduleddate/" + scheduleddate + "/scheduledtime/" + scheduledtime + "/virtualmachine";
            var xmlDocument = new XmlDocument();

            HttpResponseMessage httpResponseMessage;
            _logger.Log(string.Format("{0}, request: {1}, body: {2}", LogUtils.GetCurrentMethod(this), UrlBase, sbBody));

            using (var httpClient = new HttpClient())
            {
                HttpContent myContent = new StringContent(sbBody, Encoding.UTF8, "application/xml");
                httpClient.BaseAddress = new Uri(UrlBase);
                httpResponseMessage = httpClient.PutAsync(UrlBase, myContent).Result;
                httpResponseMessage.EnsureSuccessStatusCode();
            }

            xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
            _logger.Log(string.Format("{0}, response: {1}", LogUtils.GetCurrentMethod(this), xmlDocument.OuterXml));
            return ParseXmlResult(xmlDocument);

            #region SUCESS RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine snapshotIdentifier="35705"><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>81996</identifier><name>POWERON</name><state>SCHEDULED</state><numberOfFailures>0</numberOfFailures><serviceCode>3b59e998-2d87-42aa-bcc4-dcdae9fdffb5</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T13:31:48-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep></queueitem><region>TB1</region><state>POWERED_ON</state><cluster><identifier>122</identifier><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5123075997696</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></cluster><disks><disk snapshotIdentifier="70922"><identifier>9693</identifier><name>d9693</name><device>xvda</device><diskType>SO</diskType><format>raw</format><size>40</size><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5123075997696</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></disk></disks><frequency>900</frequency><host><flags>NO_TRUEBOX,NO_SQL,NO_WIN7</flags><identifier>9</identifier><name>spc1p009</name><region>TB1</region><state>POWERED_ON</state><admState>regular</admState><ip>177.70.104.143</ip><keepalive>3</keepalive><opState>running</opState><port>5200</port><technology>xen</technology><version>41</version><freeMemory>1234</freeMemory><frequency>2000</frequency><loadAverage>2.31</loadAverage><memory>98226</memory><storages><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5123075997696</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4687719825408</freeSize><internalIp>10.15.0.2</internalIp><size>40059</size></storage></storages><vcpu>32</vcpu></host><memory>512000</memory><networkinterfaces><networkinterface snapshotIdentifier="39920"><identifier>5315</identifier><name>tec25057.0</name><additionalips><additionalip inrange="true" snapshotIdentifier="29398"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><bandwidth>1.0</bandwidth><ipv4>177.70.97.115</ipv4><mac>00:16:3e:6b:14:7b</mac><monitor><identifier>627</identifier><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></monitor><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></networkinterface></networkinterfaces><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vcpu>2</vcpu><vncPasswd>7jpiJUkDi1</vncPasswd><vncPort>5933</vncPort></virtualmachine>
            #endregion

            #region FAIL RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>0</identifier><name>POWERON</name><state>REJECTED</state><numberOfFailures>0</numberOfFailures><serviceCode>3b59e998-2d87-42aa-bcc4-dcdae9fdffb5</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T13:31:48-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep><message>ValidationException: ServiceCode is not unique</message></queueitem></virtualmachine>
            #endregion
        }

        public ServiceResult PowerOff(Server server)
        {
            var sbBody = "";
            sbBody += "<virtualmachine>";
            sbBody += "<name>" + server.Name + "</name>";
            sbBody += "<status>poweroff</status>";
            sbBody += "</virtualmachine>";

            var scheduleddate = DateTime.Now.Date.ToString("yyyy-MM-dd");
            var scheduledtime = DateTime.Now.TimeOfDay.ToString().Split('.')[0];

            UrlBase += "cloud/rest/servicecode/" + Guid.NewGuid() + "/scheduleddate/" + scheduleddate + "/scheduledtime/" + scheduledtime + "/virtualmachine";
            var xmlDocument = new XmlDocument();

            HttpResponseMessage httpResponseMessage;
            _logger.Log(string.Format("{0}, request: {1}, body: {2}", LogUtils.GetCurrentMethod(this), UrlBase, sbBody));

            using (var httpClient = new HttpClient())
            {
                HttpContent myContent = new StringContent(sbBody, Encoding.UTF8, "application/xml");
                httpClient.BaseAddress = new Uri(UrlBase);
                httpResponseMessage = httpClient.PutAsync(UrlBase, myContent).Result;
                httpResponseMessage.EnsureSuccessStatusCode();
            }

            xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
            _logger.Log(string.Format("{0}, response: {1}", LogUtils.GetCurrentMethod(this), xmlDocument.OuterXml));
            return ParseXmlResult(xmlDocument);

            #region SUCESS RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine snapshotIdentifier="35718"><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>82012</identifier><name>SHUTDOWN</name><state>SCHEDULED</state><numberOfFailures>0</numberOfFailures><serviceCode>50cf4aad-444c-434a-a55d-95e385400a71</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T14:04:58-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep></queueitem><region>TB1</region><state>POWERED_ON</state><cluster><identifier>122</identifier><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122808610816</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></cluster><disks><disk snapshotIdentifier="70937"><identifier>9693</identifier><name>d9693</name><device>xvda</device><diskType>SO</diskType><format>raw</format><size>40</size><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122808610816</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></disk></disks><frequency>900</frequency><host><flags>NO_TRUEBOX,NO_SQL,NO_WIN7</flags><identifier>9</identifier><name>spc1p009</name><region>TB1</region><state>POWERED_ON</state><admState>regular</admState><ip>177.70.104.143</ip><keepalive>3</keepalive><opState>running</opState><port>5200</port><technology>xen</technology><version>41</version><freeMemory>724</freeMemory><frequency>2000</frequency><loadAverage>1.21</loadAverage><memory>98226</memory><storages><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122808610816</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4687545761792</freeSize><internalIp>10.15.0.2</internalIp><size>40059</size></storage></storages><vcpu>32</vcpu></host><memory>512000</memory><networkinterfaces><networkinterface snapshotIdentifier="39934"><identifier>5315</identifier><name>tec25057.0</name><additionalips><additionalip inrange="true" snapshotIdentifier="29410"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><bandwidth>1.0</bandwidth><ipv4>177.70.97.115</ipv4><mac>00:16:3e:6b:14:7b</mac><monitor><identifier>627</identifier><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></monitor><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></networkinterface></networkinterfaces><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vcpu>2</vcpu><vncPasswd>yGi1CrAKDi</vncPasswd><vncPort>5920</vncPort></virtualmachine>
            #endregion

            #region FAIL RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>0</identifier><name>SHUTDOWN</name><state>REJECTED</state><numberOfFailures>0</numberOfFailures><serviceCode>50cf4aad-444c-434a-a55d-95e385400a71</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T14:04:58-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep><message>ValidationException: ServiceCode is not unique</message></queueitem></virtualmachine>
            #endregion
        }

        public ServiceResult ShutDown(Server server)
        {
            var sbBody = "";
            sbBody += "<virtualmachine>";
            sbBody += "<name>" + server.Name + "</name>";
            sbBody += "<status>shutdown</status>";
            sbBody += "</virtualmachine>";

            var scheduleddate = DateTime.Now.Date.ToString("yyyy-MM-dd");
            var scheduledtime = DateTime.Now.TimeOfDay.ToString().Split('.')[0];

            UrlBase += "cloud/rest/servicecode/" + Guid.NewGuid() + "/scheduleddate/" + scheduleddate + "/scheduledtime/" + scheduledtime + "/virtualmachine";
            var xmlDocument = new XmlDocument();

            HttpResponseMessage httpResponseMessage;
            _logger.Log(string.Format("{0}, request: {1}, body: {2}", LogUtils.GetCurrentMethod(this), UrlBase, sbBody));

            using (var httpClient = new HttpClient())
            {
                HttpContent myContent = new StringContent(sbBody, Encoding.UTF8, "application/xml");
                httpClient.BaseAddress = new Uri(UrlBase);
                httpResponseMessage = httpClient.PutAsync(UrlBase, myContent).Result;
                httpResponseMessage.EnsureSuccessStatusCode();
            }

            xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
            _logger.Log(string.Format("{0}, response: {1}", LogUtils.GetCurrentMethod(this), xmlDocument.OuterXml));
            return ParseXmlResult(xmlDocument);

            #region SUCESS RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine snapshotIdentifier="35704"><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>81994</identifier><name>POWEROFF</name><state>SCHEDULED</state><numberOfFailures>0</numberOfFailures><serviceCode>afc48990-c615-4aed-a8d7-6761ff284054</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T13:24:31-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep></queueitem><region>TB1</region><state>POWERED_OFF</state><cluster><identifier>122</identifier><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5124323803136</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></cluster><disks><disk snapshotIdentifier="70921"><identifier>9693</identifier><name>d9693</name><device>xvda</device><diskType>SO</diskType><format>raw</format><size>40</size><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5124323803136</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></disk></disks><frequency>900</frequency><host><flags>NO_TRUEBOX,NO_SQL,NO_WIN7</flags><identifier>9</identifier><name>spc1p009</name><region>TB1</region><state>POWERED_ON</state><admState>regular</admState><ip>177.70.104.143</ip><keepalive>3</keepalive><opState>running</opState><port>5200</port><technology>xen</technology><version>41</version><freeMemory>724</freeMemory><frequency>2000</frequency><loadAverage>1.0</loadAverage><memory>98226</memory><storages><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5124323803136</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4687846703104</freeSize><internalIp>10.15.0.2</internalIp><size>40059</size></storage></storages><vcpu>32</vcpu></host><memory>512000</memory><networkinterfaces><networkinterface snapshotIdentifier="39919"><identifier>5315</identifier><name>tec25057.0</name><additionalips><additionalip inrange="true" snapshotIdentifier="29397"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><bandwidth>1.0</bandwidth><ipv4>177.70.97.115</ipv4><mac>00:16:3e:6b:14:7b</mac><monitor><identifier>627</identifier><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></monitor><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></networkinterface></networkinterfaces><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vcpu>2</vcpu><vncPasswd>7jpiJUkDi1</vncPasswd><vncPort>5933</vncPort></virtualmachine>
            #endregion

            #region FAIL RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>0</identifier><name>POWEROFF</name><state>REJECTED</state><numberOfFailures>0</numberOfFailures><serviceCode>afc48990-c615-4aed-a8d7-6761ff284054</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T13:24:31-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep><message>ValidationException: ServiceCode is not unique</message></queueitem></virtualmachine>
            #endregion
        }

        public ServiceResult Reboot(Server server)
        {
            var sbBody = "";
            sbBody += "<virtualmachine>";
            sbBody += "<name>" + server.Name + "</name>";
            sbBody += "<status>reboot</status>";
            sbBody += "</virtualmachine>";

            var scheduleddate = DateTime.Now.Date.ToString("yyyy-MM-dd");
            var scheduledtime = DateTime.Now.TimeOfDay.ToString().Split('.')[0];

            UrlBase += "cloud/rest/servicecode/" + Guid.NewGuid() + "/scheduleddate/" + scheduleddate + "/scheduledtime/" + scheduledtime + "/virtualmachine";
            var xmlDocument = new XmlDocument();

            HttpResponseMessage httpResponseMessage;
            _logger.Log(string.Format("{0}, request: {1}, body: {2}", LogUtils.GetCurrentMethod(this), UrlBase, sbBody));

            using (var httpClient = new HttpClient())
            {
                HttpContent myContent = new StringContent(sbBody, Encoding.UTF8, "application/xml");
                httpClient.BaseAddress = new Uri(UrlBase);
                httpResponseMessage = httpClient.PutAsync(UrlBase, myContent).Result;
                httpResponseMessage.EnsureSuccessStatusCode();
            }

            xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
            _logger.Log(string.Format("{0}, response: {1}", LogUtils.GetCurrentMethod(this), xmlDocument.OuterXml));
            return ParseXmlResult(xmlDocument);

            #region SUCESS RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine snapshotIdentifier="35707"><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>81998</identifier><name>REBOOT</name><state>SCHEDULED</state><numberOfFailures>0</numberOfFailures><serviceCode>b7e52e9c-580e-43e4-b064-eb44864a0ff3</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T13:37:04-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep></queueitem><region>TB1</region><state>POWERED_ON</state><cluster><identifier>122</identifier><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122971140096</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></cluster><disks><disk snapshotIdentifier="70924"><identifier>9693</identifier><name>d9693</name><device>xvda</device><diskType>SO</diskType><format>raw</format><size>40</size><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122971140096</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></disk></disks><frequency>900</frequency><host><flags>NO_TRUEBOX,NO_SQL,NO_WIN7</flags><identifier>9</identifier><name>spc1p009</name><region>TB1</region><state>POWERED_ON</state><admState>regular</admState><ip>177.70.104.143</ip><keepalive>3</keepalive><opState>running</opState><port>5200</port><technology>xen</technology><version>41</version><freeMemory>724</freeMemory><frequency>2000</frequency><loadAverage>1.13</loadAverage><memory>98226</memory><storages><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122971140096</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4687649570816</freeSize><internalIp>10.15.0.2</internalIp><size>40059</size></storage></storages><vcpu>32</vcpu></host><memory>512000</memory><networkinterfaces><networkinterface snapshotIdentifier="39922"><identifier>5315</identifier><name>tec25057.0</name><additionalips><additionalip inrange="true" snapshotIdentifier="29400"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><bandwidth>1.0</bandwidth><ipv4>177.70.97.115</ipv4><mac>00:16:3e:6b:14:7b</mac><monitor><identifier>627</identifier><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></monitor><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></networkinterface></networkinterfaces><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vcpu>2</vcpu><vncPasswd>fD8NroGF0v</vncPasswd><vncPort>5920</vncPort></virtualmachine>
            #endregion

            #region FAIL RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>0</identifier><name>REBOOT</name><state>REJECTED</state><numberOfFailures>0</numberOfFailures><serviceCode>b7e52e9c-580e-43e4-b064-eb44864a0ff3</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T13:37:04-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep><message>ValidationException: ServiceCode is not unique</message></queueitem></virtualmachine>
            #endregion
        }

        public ServiceResult Suspend(Server server)
        {
            var sbBody = "";
            sbBody += "<virtualmachine>";
            sbBody += "<name>" + server.Name + "</name>";
            sbBody += string.Format("<memo>Suspenso realizada pelo painel cloud em {0}</memo>", DateTime.Now);
            sbBody += "</virtualmachine>";

            //no possui schedule
            UrlBase += "cloud/rest/servicecode/" + Guid.NewGuid() + "/action/block/virtualmachine";
            var xmlDocument = new XmlDocument();

            HttpResponseMessage httpResponseMessage;
            _logger.Log(string.Format("{0}, request: {1}, body: {2}", LogUtils.GetCurrentMethod(this), UrlBase, sbBody));

            using (var httpClient = new HttpClient())
            {
                HttpContent myContent = new StringContent(sbBody, Encoding.UTF8, "application/xml");
                httpClient.BaseAddress = new Uri(UrlBase);
                httpClient.Timeout = TimeSpan.FromMinutes(HTTP_TIMEOUT);
                httpResponseMessage = httpClient.PutAsync(UrlBase, myContent).Result;
                httpResponseMessage.EnsureSuccessStatusCode();
            }

            xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
            _logger.Log(string.Format("{0}, response: {1}", LogUtils.GetCurrentMethod(this), xmlDocument.OuterXml));
            return ParseXmlResult(xmlDocument);

            #region SUCESS RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine lock="SUSPENDED" snapshotIdentifier="35824"><identifier>25057</identifier><name>CD119740-windows-2012-64b-std-web-sx-25057</name><queueitem><identifier>82285</identifier><name>BLOCK</name><state>COMPLETED</state><numberOfFailures>0</numberOfFailures><serviceCode>e7e096a0-3957-4509-a59d-b69b76b0f2fa</serviceCode><delegatedQueueItems><queueitem><identifier>82286</identifier><name>POWEROFF</name><state>COMPLETED</state><numberOfFailures>0</numberOfFailures><delegatedQueueItems><queueitem><identifier>82287</identifier><name>SHUTDOWN</name><state>COMPLETED</state><numberOfFailures>0</numberOfFailures><delegatedQueueItems /><startExecution>2014-10-23T13:54:39.588-02:00</startExecution><lastUpdated>2014-10-23T13:55:20.611-02:00</lastUpdated><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>1</expectedSteps><currentStep>1</currentStep></queueitem></delegatedQueueItems><startExecution>2014-10-23T13:54:39.502-02:00</startExecution><lastUpdated>2014-10-23T13:55:20.607-02:00</lastUpdated><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>3</expectedSteps><currentStep>3</currentStep></queueitem></delegatedQueueItems><startExecution>2014-10-23T13:54:33.380-02:00</startExecution><lastUpdated>2014-10-23T13:55:20.607-02:00</lastUpdated><doPoweroff>true</doPoweroff><doPoweron>false</doPoweron><expectedSteps>2</expectedSteps><currentStep>3</currentStep></queueitem><region>TB1</region><state>POWERED_OFF</state><cluster><identifier>122</identifier><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4580813307904</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage></cluster><disks><disk snapshotIdentifier="71161"><identifier>9701</identifier><name>d9701</name><device>xvda</device><diskType>SO</diskType><format>raw</format><size>40</size><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4580813307904</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage></disk><disk snapshotIdentifier="71162"><identifier>9698</identifier><name>d9698</name><device>xvdb</device><diskType>DATA</diskType><format>vhd</format><size>60</size><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4580813307904</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage><user><identifier>637</identifier><name>CD119740</name><ipranges /></user></disk></disks><frequency>900</frequency><host><flags>NO_TRUEBOX,NO_SQL,NO_LINUX,NO_WIN7</flags><identifier>11</identifier><name>spc1p011</name><region>TB1</region><state>POWERED_ON</state><admState>regular</admState><ip>177.70.104.145</ip><keepalive>3</keepalive><opState>running</opState><port>5200</port><technology>xen</technology><version>41</version><freeMemory>79475</freeMemory><frequency>2000</frequency><loadAverage>0.11</loadAverage><memory>393138</memory><storages><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4580813307904</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4551221444608</freeSize><internalIp>10.15.0.2</internalIp><size>40053</size></storage><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4580813307904</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4551221444608</freeSize><internalIp>10.15.0.2</internalIp><size>40053</size></storage></storages><vcpu>32</vcpu></host><memo>Suspenso realizada pelo painel cloud</memo><memory>1048576</memory><networkinterfaces><networkinterface snapshotIdentifier="40094"><identifier>5315</identifier><name>tec25057.0</name><additionalips><additionalip inrange="true" snapshotIdentifier="29477"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><bandwidth>1.0</bandwidth><ipv4>177.70.97.115</ipv4><mac>00:16:3e:6b:14:7b</mac><monitor><identifier>627</identifier><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></monitor><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></networkinterface></networkinterfaces><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vcpu>2</vcpu><vncPasswd>rffUtsC8Hy</vncPasswd><vncPort>5903</vncPort></virtualmachine>
            #endregion

            #region FAIL RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine><identifier>25057</identifier><name>CD119740-windows-2012-64b-std-web-sx-25057</name><queueitem><identifier>0</identifier><name>BLOCK</name><state>REJECTED</state><numberOfFailures>0</numberOfFailures><serviceCode>e7e096a0-3957-4509-a59d-b69b76b0f2fa</serviceCode><delegatedQueueItems /><startExecution>2014-10-23T13:56:10.978-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep><message>ValidationException: ServiceCode is not unique</message></queueitem><memo>Suspenso realizada pelo painel cloud</memo></virtualmachine>
            #endregion
        }

        public ServiceResult Unlock(Server server)
        {
            var sbBody = "";
            sbBody += "<collection>";
            sbBody += "<virtualmachine>";
            sbBody += "<name>" + server.Name + "</name>";
            sbBody += "<memo></memo>";
            sbBody += "</virtualmachine>";
            sbBody += "</collection>";

            var url = UrlBase;
            url += "cloud/rest/virtualmachine/setobjectlock/ok";
            var xmlDocument = new XmlDocument();

            HttpResponseMessage httpResponseMessage;
            _logger.Log(string.Format("{0}, request: {1}, body: {2}", LogUtils.GetCurrentMethod(this), url, sbBody));

            using (var httpClient = new HttpClient())
            {
                HttpContent myContent = new StringContent(sbBody, Encoding.UTF8, "application/xml");
                httpClient.BaseAddress = new Uri(url);
                httpClient.Timeout = TimeSpan.FromMinutes(HTTP_TIMEOUT);
                httpResponseMessage = httpClient.PutAsync(url, myContent).Result;
                httpResponseMessage.EnsureSuccessStatusCode();
            }

            xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
            _logger.Log(string.Format("{0}, response: {1}", LogUtils.GetCurrentMethod(this), xmlDocument.OuterXml));

            if (xmlDocument.InnerXml.Contains("virtualmachine lock=\"SUSPENDED\"") == false)
                return new ServiceResult() { Status = StatusService.SUCCESS };

            return new ServiceResult() { Status = StatusService.FAILED };

            #region SUCESS RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><collection><VirtualMachine><identifier>25057</identifier><name>CD119740-windows-2012-64b-std-web-sx-25057</name><region>TB1</region><state>POWERED_OFF</state><disks><disk><identifier>9701</identifier><name>d9701</name><device>xvda</device><format>raw</format><restorepoints /><size>40</size><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4580783947776</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage></disk><disk><identifier>9698</identifier><name>d9698</name><device>xvdb</device><format>vhd</format><restorepoints /><size>60</size><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4580783947776</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage><user><identifier>637</identifier><name>CD119740</name><additionalips><additionalip inrange="true"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><firewallrules /><ipranges /><vlans /></user></disk></disks><frequency>900</frequency><host><flags>NO_TRUEBOX,NO_SQL,NO_LINUX,NO_WIN7</flags><identifier>11</identifier><name>spc1p011</name><region>TB1</region><state>POWERED_ON</state><admState>regular</admState><ip>177.70.104.145</ip><keepalive>3</keepalive><opState>running</opState><port>5200</port><technology>xen</technology><version>41</version><freeMemory>80512</freeMemory><frequency>2000</frequency><loadAverage>1.14</loadAverage><memory>393138</memory><storages><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4580783947776</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4551199424512</freeSize><internalIp>10.15.0.2</internalIp><size>40053</size></storage><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4580783947776</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4551199424512</freeSize><internalIp>10.15.0.2</internalIp><size>40053</size></storage></storages><vcpu>32</vcpu></host><memory>1048576</memory><networkinterfaces><networkinterface><identifier>5315</identifier><name>tec25057.0</name><additionalips><additionalip inrange="true"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><bandwidth>1.0</bandwidth><firewallrules /><ipv4>177.70.97.115</ipv4><mac>00:16:3e:6b:14:7b</mac><monitor><identifier>627</identifier><user><identifier>637</identifier><name>CD119740</name><additionalips><additionalip inrange="true"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><firewallrules /><ipranges /><vlans /></user><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></monitor><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></networkinterface></networkinterfaces><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><user><identifier>637</identifier><name>CD119740</name><additionalips><additionalip inrange="true"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><firewallrules /><ipranges /><vlans /></user><vcpu>2</vcpu><vncPasswd>rffUtsC8Hy</vncPasswd><vncPort>5903</vncPort></VirtualMachine></collection>
            #endregion

            #region FAIL RETURN
            ////<?xml version="1.0" encoding="UTF-8" standalone="yes"?><collection><VirtualMachine><identifier>25057</identifier><name>CD119740-windows-2012-64b-std-web-sx-25057</name><region>TB1</region><state>POWERED_OFF</state><disks><disk><identifier>9701</identifier><name>d9701</name><device>xvda</device><format>raw</format><restorepoints /><size>40</size><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4580783947776</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage></disk><disk><identifier>9698</identifier><name>d9698</name><device>xvdb</device><format>vhd</format><restorepoints /><size>60</size><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4580783947776</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage><user><identifier>637</identifier><name>CD119740</name><additionalips><additionalip inrange="true"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><firewallrules /><ipranges /><vlans /></user></disk></disks><frequency>900</frequency><host><flags>NO_TRUEBOX,NO_SQL,NO_LINUX,NO_WIN7</flags><identifier>11</identifier><name>spc1p011</name><region>TB1</region><state>POWERED_ON</state><admState>regular</admState><ip>177.70.104.145</ip><keepalive>3</keepalive><opState>running</opState><port>5200</port><technology>xen</technology><version>41</version><freeMemory>80512</freeMemory><frequency>2000</frequency><loadAverage>1.14</loadAverage><memory>393138</memory><storages><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4580783947776</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4551199424512</freeSize><internalIp>10.15.0.2</internalIp><size>40053</size></storage><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4580783947776</freeSize><internalIp>10.14.0.2</internalIp><size>36728</size></storage><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4551199424512</freeSize><internalIp>10.15.0.2</internalIp><size>40053</size></storage></storages><vcpu>32</vcpu></host><memory>1048576</memory><networkinterfaces><networkinterface><identifier>5315</identifier><name>tec25057.0</name><additionalips><additionalip inrange="true"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><bandwidth>1.0</bandwidth><firewallrules /><ipv4>177.70.97.115</ipv4><mac>00:16:3e:6b:14:7b</mac><monitor><identifier>627</identifier><user><identifier>637</identifier><name>CD119740</name><additionalips><additionalip inrange="true"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><firewallrules /><ipranges /><vlans /></user><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></monitor><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></networkinterface></networkinterfaces><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><user><identifier>637</identifier><name>CD119740</name><additionalips><additionalip inrange="true"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><firewallrules /><ipranges /><vlans /></user><vcpu>2</vcpu><vncPasswd>rffUtsC8Hy</vncPasswd><vncPort>5903</vncPort></VirtualMachine></collection>
            #endregion
        }

        public ServiceResult Resume(Server server)
        {
            var sbBody = "";
            sbBody += "<virtualmachine>";
            sbBody += "<name>" + server.Name + "</name>";
            sbBody += "<status>resume</status>";
            sbBody += "</virtualmachine>";

            var scheduleddate = DateTime.Now.Date.ToString("yyyy-MM-dd");
            var scheduledtime = DateTime.Now.TimeOfDay.ToString().Split('.')[0];

            UrlBase += "cloud/rest/servicecode/" + Guid.NewGuid() + "/scheduleddate/" + scheduleddate + "/scheduledtime/" + scheduledtime + "/virtualmachine";
            var xmlDocument = new XmlDocument();

            HttpResponseMessage httpResponseMessage;
            _logger.Log(string.Format("{0}, request: {1}, body: {2}", LogUtils.GetCurrentMethod(this), UrlBase, sbBody));

            using (var httpClient = new HttpClient())
            {
                HttpContent myContent = new StringContent(sbBody, Encoding.UTF8, "application/xml");
                httpClient.BaseAddress = new Uri(UrlBase);
                httpResponseMessage = httpClient.PutAsync(UrlBase, myContent).Result;
                httpResponseMessage.EnsureSuccessStatusCode();
            }

            xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
            _logger.Log(string.Format("{0}, response: {1}", LogUtils.GetCurrentMethod(this), xmlDocument.OuterXml));
            return ParseXmlResult(xmlDocument);

            #region SUCESS RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine snapshotIdentifier="35710"><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>82001</identifier><name>RESUME</name><state>SCHEDULED</state><numberOfFailures>0</numberOfFailures><serviceCode>2c4c9cfb-66c0-4aff-a5fd-fcd40100d91b</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T13:49:15-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep></queueitem><region>TB1</region><state>POWERED_ON</state><cluster><identifier>122</identifier><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122843213824</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></cluster><disks><disk snapshotIdentifier="70927"><identifier>9693</identifier><name>d9693</name><device>xvda</device><diskType>SO</diskType><format>raw</format><size>40</size><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122843213824</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></disk></disks><frequency>900</frequency><host><flags>NO_TRUEBOX,NO_SQL,NO_WIN7</flags><identifier>9</identifier><name>spc1p009</name><region>TB1</region><state>POWERED_ON</state><admState>regular</admState><ip>177.70.104.143</ip><keepalive>3</keepalive><opState>running</opState><port>5200</port><technology>xen</technology><version>41</version><freeMemory>724</freeMemory><frequency>2000</frequency><loadAverage>1.01</loadAverage><memory>98226</memory><storages><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122843213824</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4687635939328</freeSize><internalIp>10.15.0.2</internalIp><size>40059</size></storage></storages><vcpu>32</vcpu></host><memory>512000</memory><networkinterfaces><networkinterface snapshotIdentifier="39925"><identifier>5315</identifier><name>tec25057.0</name><additionalips><additionalip inrange="true" snapshotIdentifier="29403"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><bandwidth>1.0</bandwidth><ipv4>177.70.97.115</ipv4><mac>00:16:3e:6b:14:7b</mac><monitor><identifier>627</identifier><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></monitor><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></networkinterface></networkinterfaces><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vcpu>2</vcpu><vncPasswd>bSzQ9aThto</vncPasswd><vncPort>5920</vncPort></virtualmachine>
            #endregion

            #region FAIL RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>0</identifier><name>RESUME</name><state>REJECTED</state><numberOfFailures>0</numberOfFailures><serviceCode>2c4c9cfb-66c0-4aff-a5fd-fcd40100d91b</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T13:49:15-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep><message>ValidationException: ServiceCode is not unique</message></queueitem></virtualmachine> 
            #endregion
        }

        public ServiceResult Reset(Server server)
        {
            var sbBody = "";
            sbBody += "<virtualmachine>";
            sbBody += "<name>" + server.Name + "</name>";
            sbBody += "<status>reset</status>";
            sbBody += "</virtualmachine>";

            var scheduleddate = DateTime.Now.Date.ToString("yyyy-MM-dd");
            var scheduledtime = DateTime.Now.TimeOfDay.ToString().Split('.')[0];

            UrlBase += "cloud/rest/servicecode/" + Guid.NewGuid() + "/scheduleddate/" + scheduleddate + "/scheduledtime/" + scheduledtime + "/virtualmachine";
            var xmlDocument = new XmlDocument();

            HttpResponseMessage httpResponseMessage;
            _logger.Log(string.Format("{0}, request: {1}, body: {2}", LogUtils.GetCurrentMethod(this), UrlBase, sbBody));

            using (var httpClient = new HttpClient())
            {
                HttpContent myContent = new StringContent(sbBody, Encoding.UTF8, "application/xml");
                httpClient.BaseAddress = new Uri(UrlBase);
                httpResponseMessage = httpClient.PutAsync(UrlBase, myContent).Result;
                httpResponseMessage.EnsureSuccessStatusCode();
            }

            xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
            _logger.Log(string.Format("{0}, response: {1}", LogUtils.GetCurrentMethod(this), xmlDocument.OuterXml));
            return ParseXmlResult(xmlDocument);

            #region SUCESS RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine snapshotIdentifier="35715"><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>82008</identifier><name>RESET</name><state>SCHEDULED</state><numberOfFailures>0</numberOfFailures><serviceCode>8636fdb1-2bc6-4119-a228-efcb4d5cda75</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T14:02:30-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep></queueitem><region>TB1</region><state>POWERED_ON</state><cluster><identifier>122</identifier><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122816999424</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></cluster><disks><disk snapshotIdentifier="70932"><identifier>9693</identifier><name>d9693</name><device>xvda</device><diskType>SO</diskType><format>raw</format><size>40</size><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122816999424</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></disk></disks><frequency>900</frequency><host><flags>NO_TRUEBOX,NO_SQL,NO_WIN7</flags><identifier>9</identifier><name>spc1p009</name><region>TB1</region><state>POWERED_ON</state><admState>regular</admState><ip>177.70.104.143</ip><keepalive>3</keepalive><opState>running</opState><port>5200</port><technology>xen</technology><version>41</version><freeMemory>724</freeMemory><frequency>2000</frequency><loadAverage>1.1</loadAverage><memory>98226</memory><storages><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122816999424</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4687559393280</freeSize><internalIp>10.15.0.2</internalIp><size>40059</size></storage></storages><vcpu>32</vcpu></host><memory>512000</memory><networkinterfaces><networkinterface snapshotIdentifier="39930"><identifier>5315</identifier><name>tec25057.0</name><additionalips><additionalip inrange="true" snapshotIdentifier="29408"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><bandwidth>1.0</bandwidth><ipv4>177.70.97.115</ipv4><mac>00:16:3e:6b:14:7b</mac><monitor><identifier>627</identifier><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></monitor><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></networkinterface></networkinterfaces><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vcpu>2</vcpu><vncPasswd>Y4e7ejwR3K</vncPasswd><vncPort>5920</vncPort></virtualmachine>
            #endregion

            #region FAIL RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>0</identifier><name>RESET</name><state>REJECTED</state><numberOfFailures>0</numberOfFailures><serviceCode>6060aa8c-1007-45c0-98a5-1d642318d27d</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T13:59:07-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep><message>ValidationException: A process of RESET at subprocess RESET is already running for VirtualMachine CD119740-windows-25057 (serviceCode:91f5d163-028f-4575-8649-8e788bdf842f)</message></queueitem></virtualmachine>
            #endregion
        }

        public ServiceResult Pause(Server server)
        {
            var sbBody = "";
            sbBody += "<virtualmachine>";
            sbBody += "<name>" + server.Name + "</name>";
            sbBody += "<status>suspend</status>";
            sbBody += "</virtualmachine>";

            var scheduleddate = DateTime.Now.Date.ToString("yyyy-MM-dd");
            var scheduledtime = DateTime.Now.TimeOfDay.ToString().Split('.')[0];

            UrlBase += "cloud/rest/servicecode/" + Guid.NewGuid() + "/scheduleddate/" + scheduleddate + "/scheduledtime/" + scheduledtime + "/virtualmachine";
            var xmlDocument = new XmlDocument();

            HttpResponseMessage httpResponseMessage;
            _logger.Log(string.Format("{0}, request: {1}, body: {2}", LogUtils.GetCurrentMethod(this), UrlBase, sbBody));

            using (var httpClient = new HttpClient())
            {
                HttpContent myContent = new StringContent(sbBody, Encoding.UTF8, "application/xml");
                httpClient.BaseAddress = new Uri(UrlBase);
                httpResponseMessage = httpClient.PutAsync(UrlBase, myContent).Result;
                httpResponseMessage.EnsureSuccessStatusCode();
            }

            xmlDocument.LoadXml(httpResponseMessage.Content.ReadAsStringAsync().Result);
            _logger.Log(string.Format("{0}, response: {1}", LogUtils.GetCurrentMethod(this), xmlDocument.OuterXml));
            return ParseXmlResult(xmlDocument);

            #region SUCESS RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine snapshotIdentifier="35709"><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>82000</identifier><name>SUSPEND</name><state>SCHEDULED</state><numberOfFailures>0</numberOfFailures><serviceCode>66a336ec-36f1-49e1-aee0-a33fc7a3666f</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T13:43:34-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep></queueitem><region>TB1</region><state>SUSPENDED</state><cluster><identifier>122</identifier><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122927099904</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></cluster><disks><disk snapshotIdentifier="70926"><identifier>9693</identifier><name>d9693</name><device>xvda</device><diskType>SO</diskType><format>raw</format><size>40</size><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122927099904</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage></disk></disks><frequency>900</frequency><host><flags>NO_TRUEBOX,NO_SQL,NO_WIN7</flags><identifier>9</identifier><name>spc1p009</name><region>TB1</region><state>POWERED_ON</state><admState>regular</admState><ip>177.70.104.143</ip><keepalive>3</keepalive><opState>running</opState><port>5200</port><technology>xen</technology><version>41</version><freeMemory>724</freeMemory><frequency>2000</frequency><loadAverage>1.04</loadAverage><memory>98226</memory><storages><storage><identifier>1</identifier><name>spsto001</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>5122927099904</freeSize><internalIp>10.14.0.2</internalIp><size>36722</size></storage><storage><identifier>2</identifier><name>spsto002</name><region>TB1</region><state>POWERED_ON</state><admState>preferred</admState><ip>177.70.104.144</ip><keepalive>5</keepalive><opState>loaded</opState><port>5200</port><technology>nfs</technology><version></version><freeSize>4687644327936</freeSize><internalIp>10.15.0.2</internalIp><size>40059</size></storage></storages><vcpu>32</vcpu></host><memory>512000</memory><networkinterfaces><networkinterface snapshotIdentifier="39924"><identifier>5315</identifier><name>tec25057.0</name><additionalips><additionalip inrange="true" snapshotIdentifier="29402"><identifier>978</identifier><ipv4>177.70.97.117</ipv4></additionalip></additionalips><bandwidth>1.0</bandwidth><ipv4>177.70.97.115</ipv4><mac>00:16:3e:6b:14:7b</mac><monitor><identifier>627</identifier><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></monitor><vlan validRange="true" firewall="true" dhcp="true"><identifier>1</identifier><name>virtbr8</name><region>TB1</region><firewallrules /><ipranges><iprange additional="false"><identifier>1</identifier><region>TB1</region><firstip>177.70.96.4</firstip><lastip>177.70.99.254</lastip></iprange><iprange additional="false"><identifier>2</identifier><firstip>192.168.168.1</firstip><lastip>192.168.168.254</lastip></iprange><iprange additional="false"><identifier>3</identifier><firstip>10.2.0.7</firstip><lastip>10.2.0.254</lastip></iprange><iprange additional="false"><identifier>4</identifier><firstip>10.1.1.7</firstip><lastip>10.1.1.254</lastip></iprange><iprange additional="false"><identifier>5</identifier><firstip>192.168.200.7</firstip><lastip>192.168.200.254</lastip></iprange><iprange additional="false"><identifier>7</identifier><firstip>192.168.41.7</firstip><lastip>192.168.41.254</lastip></iprange><iprange additional="false"><identifier>8</identifier><firstip>192.168.201.7</firstip><lastip>192.168.201.254</lastip></iprange><iprange additional="false"><identifier>9</identifier><firstip>192.168.202.7</firstip><lastip>192.168.202.254</lastip></iprange><iprange additional="false"><identifier>12</identifier><firstip>192.168.204.7</firstip><lastip>192.168.204.254</lastip></iprange><iprange additional="false"><identifier>13</identifier><firstip>192.168.205.7</firstip><lastip>192.168.205.254</lastip></iprange><iprange additional="false"><identifier>14</identifier><firstip>192.168.4.7</firstip><lastip>192.168.4.254</lastip></iprange><iprange additional="false"><identifier>15</identifier><firstip>192.168.207.7</firstip><lastip>192.168.207.254</lastip></iprange><iprange additional="false"><identifier>18</identifier><firstip>192.168.208.7</firstip><lastip>192.168.208.254</lastip></iprange><iprange additional="false"><identifier>23</identifier><firstip>192.168.56.7</firstip><lastip>192.168.56.254</lastip></iprange><iprange additional="false"><identifier>24</identifier><firstip>192.168.209.7</firstip><lastip>192.168.209.254</lastip></iprange><iprange additional="false"><identifier>26</identifier><firstip>192.168.11.7</firstip><lastip>192.168.11.254</lastip></iprange><iprange additional="false"><identifier>27</identifier><firstip>192.168.12.7</firstip><lastip>192.168.12.254</lastip></iprange><iprange additional="false"><identifier>28</identifier><firstip>192.168.211.7</firstip><lastip>192.168.211.254</lastip></iprange><iprange additional="false"><identifier>30</identifier><firstip>192.168.212.7</firstip><lastip>192.168.212.254</lastip></iprange><iprange additional="false"><identifier>31</identifier><firstip>192.168.213.7</firstip><lastip>192.168.213.254</lastip></iprange><iprange additional="false"><identifier>32</identifier><firstip>192.168.214.7</firstip><lastip>192.168.214.254</lastip></iprange><iprange additional="false"><identifier>34</identifier><firstip>192.168.14.7</firstip><lastip>192.168.14.254</lastip></iprange><iprange additional="false"><identifier>35</identifier><firstip>192.168.216.7</firstip><lastip>192.168.216.254</lastip></iprange><iprange additional="false"><identifier>36</identifier><firstip>10.0.0.7</firstip><lastip>10.0.0.254</lastip></iprange><iprange additional="false"><identifier>39</identifier><firstip>192.168.217.7</firstip><lastip>192.168.217.254</lastip></iprange><iprange additional="false"><identifier>43</identifier><firstip>192.168.221.7</firstip><lastip>192.168.221.254</lastip></iprange><iprange additional="false"><identifier>44</identifier><firstip>192.168.222.7</firstip><lastip>192.168.222.254</lastip></iprange></ipranges><networkPrefixSize>0</networkPrefixSize><router><identifier>1</identifier><name>SPFW001</name><region>TB1</region><admState>regular</admState><ip>177.70.104.129</ip><externalIf>bond0.1000</externalIf><internalIf>bond0</internalIf><rate>10000Mbit</rate><secondaryVirtualIp>0.0.0.0</secondaryVirtualIp></router><vlanid>8</vlanid></vlan></networkinterface></networkinterfaces><software><flags>WIN</flags><identifier>62</identifier><name>windows-2012-64b-std-web-sx</name><fileSystem>refs</fileSystem><initialDisks><initialDisk><identifier>191</identifier><diskName>xvda</diskName><diskType>SO</diskType><format>raw</format></initialDisk></initialDisks><placement>nfs</placement><size>40</size><user><flags>SOFTWARE_PUBLISHER</flags><identifier>304</identifier><name>CD117497</name><additionalips /><firewallrules /><ipranges /><mssKey>N5U1L28WVRSHTQQJTP1J</mssKey><mssSecretKey>BMfaY09IsmYRbL9ZTd+VirHcMVMMTnWFAX5sqS1D</mssSecretKey><vlans /></user></software><user><identifier>637</identifier><name>CD119740</name><ipranges /></user><vcpu>2</vcpu><vncPasswd>bSzQ9aThto</vncPasswd><vncPort>5920</vncPort></virtualmachine>
            #endregion

            #region FAIL RETURN
            //<?xml version="1.0" encoding="UTF-8" standalone="yes"?><virtualmachine><identifier>25057</identifier><name>CD119740-windows-25057</name><queueitem><identifier>0</identifier><name>SUSPEND</name><state>REJECTED</state><numberOfFailures>0</numberOfFailures><serviceCode>66a336ec-36f1-49e1-aee0-a33fc7a3666f</serviceCode><delegatedQueueItems /><startExecution>2014-10-21T13:43:34-02:00</startExecution><doPoweroff>false</doPoweroff><doPoweron>false</doPoweron><expectedSteps>0</expectedSteps><currentStep>0</currentStep><message>ValidationException: ServiceCode is not unique</message></queueitem></virtualmachine>
            #endregion
        }

        public ServiceResult Refresh(Server server)
        {
            throw new NotImplementedException();
        }
    }
}